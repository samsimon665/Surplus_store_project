{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{{ product.name }} | SURPLUS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <!-- BOOTSTRAP FIRST -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- YOUR GLOBAL CSS AFTER -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">

    <!-- GOOGLE FONTS -->
    <link
        href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Montserrat:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- ICONS -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>


    <style>
        :root {
            --color-bg: #000000;
            --color-accent: #F2E700;
            --color-surface: #111111;
            --color-surface-soft: #141414;
            --color-text: #EEEEEE;
            --color-text-muted: #888888;
            --font-display: 'Bebas Neue', sans-serif;
            --font-body: 'Montserrat', sans-serif;
            --radius-lg: 18px;
            --radius-pill: 999px;
        }

        body {
            background-color: var(--color-bg);
            color: var(--color-text);
            font-family: var(--font-body);
            overflow-x: hidden;
            margin-top: 80px;
        }

        h1,
        h2,
        h3,
        .btn-add-cart {
            font-family: var(--font-display);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* LAYOUT */
        .product-container {
            max-width: 1200px;
            padding: 2rem 1rem;

        }

        .product-grid {
            display: grid;
            grid-template-columns: 1.1fr 0.9fr;
            gap: 4rem;
            align-items: start;
        }

        @media (max-width: 992px) {
            .product-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
        }

        /* GALLERY */
        .gallery-wrapper {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 600px;
        }

        .main-image-frame {
            aspect-ratio: 4/5;
            background: #0a0a0a;
            border-radius: var(--radius-lg);
            border: 1px solid rgba(255, 255, 255, 0.08);
            overflow: hidden;
            position: relative;
        }

        .main-image-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .thumbs-row {
            display: flex;
            justify-content: center;
            /* centers thumbnails */
            gap: 12px;
            margin-top: 5px;
            /* moves thumbnails lower */
            padding-bottom: 6px;
        }


        .thumb-frame {
            width: 70px;
            aspect-ratio: 4/5;
            border-radius: 8px;
            cursor: pointer;
            opacity: 0.5;
            transition: all 0.3s;
            border: 1px solid transparent;
            overflow: hidden;
            flex-shrink: 0;
        }

        .thumb-frame:hover {
            opacity: 0.8;
        }

        .thumb-frame.active {
            opacity: 1;
            border-color: var(--color-accent);
            transform: translateY(-2px);
        }

        .thumb-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;

        }

        /* PRODUCT INFO */
        .product-title {
            font-size: 3.5rem;
            line-height: 0.9;
            margin-bottom: 1rem;
            font-weight: 400;
        }

        .product-price {
            font-size: 1.8rem;
            color: var(--color-accent);
            font-family: var(--font-display);
            margin-bottom: 0.5rem;
        }

        .product-desc-short {
            color: var(--color-text-muted);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            max-width: 90%;
        }

        /* VARIANTS */
        .variant-group {
            margin-bottom: 2rem;
        }

        .variant-label {
            font-size: 0.85rem;
            color: var(--color-text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: block;
        }

        /* COLORS */
        .color-option input,
        .size-option input {
            display: none;
        }

        .color-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .color-swatch {
            padding: 8px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-pill);
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            background: transparent;
            color: #fff;
        }

        .color-option input:checked+.color-swatch {
            background: #fff;
            color: #000;
            border-color: #fff;
            font-weight: 600;
        }

        /* SIZES */
        .size-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
        }

        .size-box {
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            height: 55px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            background: transparent;
        }

        .size-box:hover {
            border-color: rgba(255, 255, 255, 0.5);
        }

        .size-option input:checked+.size-box {
            background: var(--color-accent);
            border-color: var(--color-accent);
            color: #000;
        }

        .size-option input:disabled+.size-box {
            opacity: 0.3;
            cursor: not-allowed;
            border-style: dashed;
        }

        .size-name {
            font-weight: 600;
            line-height: 1;
            margin-bottom: 2px;
        }

        .size-weight {
            font-size: 0.75rem;
            opacity: 0.8;
        }

        /* ACTIONS */
        .btn-add-cart {
            width: 100%;
            padding: 18px;
            background: var(--color-accent);
            color: #000;
            border: none;
            font-size: 1.4rem;
            font-weight: 400;
            border-radius: 8px;
            margin-top: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .btn-add-cart:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(242, 231, 0, 0.15);
        }

        /* DETAILS COLLAPSIBLE */
        .detail-group {
            margin-top: 3rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-section {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-header {
            padding: 20px 0;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: var(--font-display);
            font-size: 1.2rem;
            letter-spacing: 1px;
            color: #fff;
            transition: color 0.3s;
        }

        .detail-header:hover {
            color: var(--color-accent);
        }

        .detail-content {
            display: none;
            color: var(--color-text-muted);
            line-height: 1.6;
            padding-bottom: 20px;
            font-size: 0.95rem;
        }

        .detail-section.active .detail-content {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-5px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* RECS */
        .rec-section {
            margin-top: 6rem;
            padding-top: 4rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .section-title {
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .rec-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        .rec-card {
            background: transparent;
            transition: transform 0.3s;
        }

        .rec-card:hover {
            transform: translateY(-5px);
        }

        .rec-img-frame {
            aspect-ratio: 3/4;
            background: #111;
            margin-bottom: 1rem;
            overflow: hidden;
            border-radius: 4px;
        }

        .rec-img-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: grayscale(100%);
            transition: filter 0.3s;
        }

        .rec-card:hover img {
            filter: grayscale(0%);
        }

        .rec-title {
            font-size: 1rem;
            color: #fff;
            margin-bottom: 4px;
        }

        .rec-price {
            color: var(--color-text-muted);
            font-size: 0.9rem;
        }

        /* NAVBAR (LOCKED ‚Äì SAME AS PRODUCT LIST) */
        .navbar {
            background: rgba(0, 0, 0, 0.96);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.9rem 0;
            backdrop-filter: blur(12px);
        }

        .navbar-brand {
            font-size: 1.9rem;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.72) !important;
            font-size: 1.05rem;
            margin-left: 1rem;
            padding-top: 0.35rem;
            padding-bottom: 0.35rem;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--color-accent) !important;
        }


        /* CONTROL MAIN IMAGE SIZE */
        .main-image-frame {
            max-width: 420px;
            /* adjust if needed */
            margin: 0 auto;
        }

        /* THUMB CONTAINER */
        .custom-thumbs {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 18px;
        }

        /* THUMB */
        .custom-thumbs .thumb-frame {
            width: 72px;
            height: 90px;
            padding: 0;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid transparent;
            background: #111;
            opacity: 0.45;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        /* IMAGE MUST FILL */
        .custom-thumbs .thumb-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* ACTIVE */
        .custom-thumbs .thumb-frame.active {
            opacity: 1;
            border-color: var(--color-accent);
        }

        .carousel-control-prev,
        .carousel-control-next {
            width: 48px;
            opacity: 1;
            z-index: 5;
        }

        .carousel-control-prev-icon,
        .carousel-control-next-icon {
            background-color: rgba(0, 0, 0, 0.75);
            border-radius: 50%;
            background-size: 60% 60%;
        }

        .carousel-control-prev {
            left: 10px;
        }

        .carousel-control-next {
            right: 10px;
        }


        .carousel-control-prev:hover,
        .carousel-control-next:hover {
            opacity: 1;
        }



        /* FOOTER */
        .site-footer {
            margin-top: 6rem;
            background: #000;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-container {
            padding: 3rem 1rem 2rem;
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
        }

        .footer-logo {
            font-family: var(--font-display);
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .footer-text {
            color: var(--color-text-muted);
            font-size: 0.9rem;
            max-width: 260px;
        }

        .footer-title {
            font-size: 0.9rem;
            letter-spacing: 1px;
            margin-bottom: 0.75rem;
        }

        .footer-links {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-links li {
            margin-bottom: 0.4rem;
        }

        .footer-links a {
            color: var(--color-text-muted);
            font-size: 0.9rem;
            text-decoration: none;
        }

        .footer-links a:hover {
            color: var(--color-accent);
        }

        .footer-bottom {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
            text-align: center;
            font-size: 0.8rem;
            color: var(--color-text-muted);
        }

        /* MOBILE */
        @media (max-width: 768px) {
            .footer-grid {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .footer-text {
                margin: 0 auto;
            }
        }


        .product-actions {
            display: flex;
            gap: 14px;
            margin-bottom: 2rem;
        }

        .btn-wishlist,
        .btn-share {
            flex: 1;
            padding: 14px;
            background: transparent;
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 8px;
            font-family: var(--font-display);
            font-size: 1rem;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.25s ease;
        }

        .btn-wishlist:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--color-accent);
        }

        .btn-share:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .btn-wishlist .material-symbols-outlined,
        .btn-share .material-symbols-outlined {
            font-size: 20px;
        }

        .btn-add-cart {
            position: relative;
            overflow: hidden;
        }

        /* text stays above animation */
        .btn-add-cart .btn-text {
            position: relative;
            z-index: 2;
        }

        /* sweep layer */
        .btn-add-cart .btn-sweep {
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: #000;
            z-index: 1;
        }

        /* ALERT OVERLAY */
        #ui-alert-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

       

        /* MESSAGE */
        #ui-alert-message {
            font-size: 1rem;
            line-height: 1.6;
            margin-bottom: 24px;
        }


        

        /* POP ANIMATION */
        @keyframes alertPop {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(10px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        .btn-add-cart.animating .btn-sweep {
            animation: sweepLR 0.6s ease-out forwards;
        }

        @keyframes sweepLR {
            from {
                left: -100%;
            }
            to {
                left: 100%;
            }
        }

        .ui-alert-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin-top: 24px;
        }



        .ui-btn-primary {
            background: var(--color-accent);
            color: #000;
            padding: 10px 22px;
            border-radius: 8px;
            font-family: var(--font-display);
            font-size: 1rem;
            text-decoration: none;
        }

        .ui-btn-secondary {
            background: transparent;
            color: #fff;
            border: 1px solid rgba(255,255,255,0.4);
            padding: 10px 22px;
            border-radius: 8px;
            font-family: var(--font-display);
            font-size: 1rem;
            cursor: pointer;
        }

        .ui-btn-secondary:hover {
            border-color: var(--color-accent);
            color: var(--color-accent);
        }

        #ui-alert-box {
            background: #0f0f0f;
            color: #ffffff;
            width: 460px;
            padding: 28px 32px;
            border-radius: 16px;
            border: 1px solid var(--color-accent);
            font-family: Montserrat;
            text-align: center;
            box-shadow: 0 24px 70px rgba(0, 0, 0, 0.75);
            animation: alertPop 0.25s ease-out;
        }

        #ui-alert-ok,
        #ui-alert-close,
        #ui-alert-cart {
            height: 40px;
            min-width: 110px;
            padding: 0 18px;
            border-radius: 10px;
            font-family: var(--font-display);
            font-size: 0.95rem;
            letter-spacing: 1px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            text-decoration: none;
        }

        /* PRIMARY ACTION */
        #ui-alert-cart {
            background: var(--color-accent);
            color: #000;
            border: none;
        }

        #ui-alert-cart:hover {
            box-shadow: 0 6px 20px rgba(242, 231, 0, 0.35);
        }

        /* SECONDARY ACTION */
        #ui-alert-close,
        #ui-alert-ok {
            background: transparent;
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        #ui-alert-close:hover,
        #ui-alert-ok:hover {
            border-color: var(--color-accent);
            color: var(--color-accent);
        }

        /* ‚ù§Ô∏è Wishlist Button ‚Äì Premium */
        .btn-wishlist {
            transition: 
                background 0.25s ease,
                color 0.25s ease,
                transform 0.18s ease;
        }

        .btn-wishlist .material-symbols-outlined {
            font-variation-settings: 'FILL' 1, 'wght' 400;
            color: #e10600;
            transition:
                font-variation-settings 0.2s ease,
                transform 0.18s ease,
                color 0.2s ease;
        }

        /* ACTIVE (Wishlisted) */
        .btn-wishlist.active {
            background: #fff;
            color: #e10600; /* premium red */
        }



    </style>

</head>

<body>

    <!-- ‚úÖ NAVBAR WITH CORRECT CONTEXT -->
    {% include 'catalog/navbar.html' %}

    <main class="product-page">
        <div class="container product-container">

            <div class="product-grid">

                <!-- LEFT: IMAGE GALLERY -->
                <div>
                    {% for color, data in variants.items %}
                    <div id="gallery-{{ color|slugify }}"
                        class="gallery-wrapper {% if not forloop.first %}d-none{% endif %}">

                        <!-- MAIN IMAGE CAROUSEL -->
                        <div id="carousel-{{ color|slugify }}" class="carousel slide main-image-frame">
                            <div class="carousel-inner">
                                {% for img in data.images %}
                                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                                    <img src="{{ img }}" class="d-block w-100">
                                </div>
                                {% endfor %}
                            </div>

                            <button class="carousel-control-prev" type="button"
                                data-bs-target="#carousel-{{ color|slugify }}" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon"></span>
                            </button>

                            <button class="carousel-control-next" type="button"
                                data-bs-target="#carousel-{{ color|slugify }}" data-bs-slide="next">
                                <span class="carousel-control-next-icon"></span>
                            </button>
                        </div>


                        <!-- THUMBNAILS AS INDICATORS -->
                        <div class="thumbs-row custom-thumbs">

                            {% for img in data.images %}
                            <button type="button" class="thumb-frame {% if forloop.first %}active{% endif %}"
                                data-carousel="carousel-{{ color|slugify }}" data-index="{{ forloop.counter0 }}"
                                onclick="handleThumbClick(this)">
                                <img src="{{ img }}">
                            </button>


                            {% endfor %}
                        </div>

                    </div>
                    {% endfor %}
                </div>


                <!-- RIGHT: PRODUCT INFO -->
                <div>
                    <h1 class="product-title">{{ product.name }}</h1>
                    <div class="product-price">‚Çπ {{ price_per_kg }} / KG</div>

                    <p class="product-desc-short">
                        Authentic surplus inventory. Hand-checked for quality and condition.
                        Sustainable fashion at a fraction of the cost.
                    </p>


                    <div class="product-actions">

                        <button type="button" id="wishlistBtn" class="btn-wishlist {% if is_wishlisted %}active{% endif %}"
                            data-product-id="{{ product.id }}">
                            <span class="material-symbols-outlined">
                                favorite
                            </span>
                            {% if is_wishlisted %}
                            REMOVE FROM WISHLIST
                            {% else %}
                            ADD TO WISHLIST
                            {% endif %}
                        </button>



                        <button type="button" class="btn-share">
                            <span class="material-symbols-outlined">share</span>
                            SHARE
                        </button>

                    </div>


                    <form id="add-to-cart-form" method="POST" action="{% url 'cart:add_to_cart' %}">

                        {% csrf_token %}

                        <!-- COLOR SELECTION -->
                        <div class="variant-group">
                            <span class="variant-label">Select Color</span>
                            <div class="color-row">
                                {% for color, data in variants.items %}
                                <label class="color-option">
                                    <input type="radio" name="color" value="{{ color }}" data-slug="{{ color|slugify }}"
                                        onchange="handleColorChange(this.dataset.slug)" {% if forloop.first %} checked {% endif %}>
                                    <div class="color-swatch">{{ color }}</div>
                                </label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- SIZE / VARIANT SELECTION -->
                        <div class="variant-group">
                            <span class="variant-label">Select Size & Weight</span>

                            {% for color, data in variants.items %}
                            <div id="size-group-{{ color|slugify }}"
                                class="{% if not forloop.first %}d-none{% endif %}">

                                <div class="size-grid">
                                    {% for s in data.sizes %}
                                    <label class="size-option">
                                        <input type="radio" name="variant_id" value="{{ s.variant_id }}" {% if not s.stock %} disabled {% endif %}>
                                        <div class="size-box">
                                            <div class="size-name">{{ s.size }}</div>
                                            <div class="size-weight">{{ s.weight_kg }} kg</div>
                                        </div>
                                    </label>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- SUBMIT -->
                        <button type="submit" class="btn-add-cart" id="addToCartBtn">
                            <span class="btn-text">ADD TO CART</span>
                            <span class="btn-sweep"></span>
                        </button>
                        

                        {% if from_wishlist and wishlist_item_id %}
                        <input type="hidden" name="from_wishlist" value="1">
                        <input type="hidden" name="wishlist_item_id" value="{{ wishlist_item_id }}">
                        {% endif %}


                    </form>





                    <!-- DETAILS COLLAPSIBLE (Static) -->
                    <div class="detail-group">
                        <div class="detail-section" onclick="toggleDetail(this)">
                            <div class="detail-header">
                                DESCRIPTION
                                <span class="material-symbols-outlined">add</span>
                            </div>
                            <div class="detail-content">
                                <p>{{ product.description }}</p>
                                <ul>
                                    <li>Material: Cotton/Pol Blend</li>
                                    <li>Fit: Regular</li>
                                    <li>Condition: Brand New with Tags</li>
                                </ul>
                            </div>
                        </div>

                        <div class="detail-section" onclick="toggleDetail(this)">
                            <div class="detail-header">
                                SHIPPING & RETURNS
                                <span class="material-symbols-outlined">add</span>
                            </div>
                            <div class="detail-content">
                                <p>Standard shipping: 3-5 business days. Returns accepted within 14 days of delivery if
                                    item
                                    is in original condition.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {% if recommended_products %}
            <!-- RECOMMENDED PRODUCTS -->
            <div class="rec-section">
                <h2 class="section-title">YOU MIGHT ALSO LIKE</h2>

                <div class="rec-grid">
                    {% for p in recommended_products %}
                    <a href="{{ p.get_absolute_url }}" class="rec-card text-decoration-none">

                        <!-- IMAGE -->
                        <div class="rec-img-frame">
                            {% if p.variants.all %}
                            {% with v=p.variants.all.0 %}
                            {% if v.images.all %}
                            <img src="{{ v.images.all.0.image.url }}" alt="{{ p.name }}">
                            {% else %}
                            <img src="https://via.placeholder.com/400x550?text=No+Image">
                            {% endif %}
                            {% endwith %}
                            {% else %}
                            <img src="https://via.placeholder.com/400x550?text=No+Image">
                            {% endif %}
                        </div>

                        <!-- TITLE -->
                        <div class="rec-title">{{ p.name }}</div>

                        <!-- PRICE -->
                        <div class="rec-price">
                            ‚Çπ {{ p.subcategory.price_per_kg }} / KG
                        </div>

                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}



        </div>
    </main>

    <footer class="site-footer">
        <div class="container footer-container">

            <div class="footer-grid">
                <!-- BRAND -->
                <div class="footer-col">
                    <h3 class="footer-logo">SURPLUSSTORE</h3>
                    <p class="footer-text">
                        Sustainable surplus fashion.
                        Weight-based pricing. No brand bias.
                    </p>
                </div>

                <!-- LINKS -->
                <div class="footer-col">
                    <h4 class="footer-title">Shop</h4>
                    <ul class="footer-links">
                        <li><a href="#">Men</a></li>
                        <li><a href="#">Women</a></li>
                        <li><a href="#">Categories</a></li>
                    </ul>
                </div>

                <!-- INFO -->
                <div class="footer-col">
                    <h4 class="footer-title">Company</h4>
                    <ul class="footer-links">
                        <li><a href="#">About</a></li>
                        <li><a href="#">Shipping</a></li>
                        <li><a href="#">Returns</a></li>
                    </ul>
                </div>
            </div>

            <div class="footer-bottom">
                ¬© {{ now|date:"Y" }} SURPLUSSTORE. All rights reserved.
            </div>

        </div>
    </footer>



    <!-- JS -->
    <script>
        function handleColorChange(slug) {

                /* 1Ô∏è‚É£ Switch galleries */
                document.querySelectorAll('.gallery-wrapper')
                    .forEach(g => g.classList.add('d-none'));
                document.getElementById('gallery-' + slug)
                    ?.classList.remove('d-none');

                /* 2Ô∏è‚É£ Switch size groups */
                document.querySelectorAll('[id^="size-group-"]')
                    .forEach(group => group.classList.add('d-none'));

                const activeSizeGroup = document.getElementById('size-group-' + slug);
                if (activeSizeGroup) {
                    activeSizeGroup.classList.remove('d-none');
                }

                /* 3Ô∏è‚É£ CLEAR previously selected variant_id */
                document.querySelectorAll('input[name="variant_id"]')
                    .forEach(input => input.checked = false);
            }


        function toggleDetail(el) {
            el.classList.toggle('active');
        }

        /* ‚úÖ SINGLE SOURCE OF TRUTH */
        function handleThumbClick(btn) {
            const carouselId = btn.dataset.carousel;
            const index = Number(btn.dataset.index);

            const carouselEl = document.getElementById(carouselId);
            if (!carouselEl) return;

            const carousel = bootstrap.Carousel.getOrCreateInstance(carouselEl);
            carousel.to(index);
        }

        /* ‚úÖ Sync thumbs when carousel slides */
        document.querySelectorAll('.carousel').forEach(carouselEl => {
            carouselEl.addEventListener('slid.bs.carousel', e => {
                const wrapper = carouselEl.closest('.gallery-wrapper');
                if (!wrapper) return;

                wrapper.querySelectorAll('.thumb-frame')
                    .forEach(t => t.classList.remove('active'));

                const thumbs = wrapper.querySelectorAll('.thumb-frame');
                if (thumbs[e.to]) thumbs[e.to].classList.add('active');
            });
        });
    </script>


    <script>
        function showUIAlert(message, type = "error") {
            const overlay = document.getElementById("ui-alert-overlay");
            const msgBox = document.getElementById("ui-alert-message");

            const okBtn = document.getElementById("ui-alert-ok");
            const closeBtn = document.getElementById("ui-alert-close");
            const cartBtn = document.getElementById("ui-alert-cart");

            if (!overlay || !msgBox) return;

            msgBox.textContent = message;

            // RESET (hide all)
            okBtn.style.display = "none";
            closeBtn.style.display = "none";
            cartBtn.style.display = "none";

            // ‚ùå ERROR (size not selected, stock issue)
            if (type === "error") {
                okBtn.style.display = "inline-block";
            }

            // ‚úÖ SUCCESS (item added)
            if (type === "success") {
                closeBtn.style.display = "inline-block";
                cartBtn.style.display = "inline-flex";
            }

            overlay.style.display = "flex";
        }

        function hideUIAlert() {
            const overlay = document.getElementById("ui-alert-overlay");
            if (overlay) overlay.style.display = "none";
        }
    </script>
        
        

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("add-to-cart-form");
            const btn = document.getElementById("addToCartBtn");

            if (!form || !btn) return;

            form.addEventListener("submit", async (e) => {
                e.preventDefault();

                // 1Ô∏è‚É£ Validate size selection
                const variant = form.querySelector("input[name='variant_id']:checked");
                if (!variant) {
                    showUIAlert("Please select a size");
                    return;
                }

                // 2Ô∏è‚É£ Start animation
                btn.disabled = true;
                btn.classList.add("animating");

                // 3Ô∏è‚É£ Send request
                const response = await fetch(form.action, {
                    method: "POST",
                    body: new FormData(form),
                    headers: { "X-Requested-With": "XMLHttpRequest" }
                });

                const data = await response.json();

                // ‚ùå Error from backend
                if (!response.ok) {
                    btn.classList.remove("animating");
                    btn.disabled = false;
                    showUIAlert(data.error || "Something went wrong");
                    return;
                }

                // ‚úÖ SUCCESS
                showUIAlert("Item added successfully", "success");



                // 4Ô∏è‚É£ Reset button
                setTimeout(() => {
                    btn.classList.remove("animating");
                    btn.disabled = false;
                }, 600);
            });
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const btn = document.getElementById("wishlistBtn");
            if (!btn) return;

            btn.addEventListener("click", async () => {
                const productId = btn.dataset.productId;
                const heartIcon = btn.querySelector('.material-symbols-outlined');
                const textNode = btn.lastChild;

                // Disable button during request
                btn.style.pointerEvents = 'none';

                try {
                    const response = await fetch("{% url 'cart:toggle_wishlist' %}", {
                        method: "POST",
                        headers: {
                            "X-CSRFToken": "{{ csrf_token }}",
                            "Content-Type": "application/x-www-form-urlencoded"
                        },
                        body: new URLSearchParams({ product_id: productId })
                    });

                    const data = await response.json();

                    if (!data.success) {
                        btn.style.pointerEvents = 'auto';
                        return;
                    }

                    // üî• PREMIUM ANIME.JS ANIMATION
                    if (data.action === "added") {
                        // ADD TO WISHLIST ‚Üí HEARTBEAT + FLOATING HEARTS + FILL
                        anime({
                            targets: heartIcon,
                            scale: [1, 1.4, 1.2, 1],
                            rotate: [0, 360],
                            duration: 800,
                            easing: 'easeOutElastic(1, .8)',
                            loop: false
                        });

                        // Create 5 floating hearts
                        for (let i = 0; i < 5; i++) {
                            createFloatingHeart(heartIcon);
                        }

                        // Button state change
                        btn.classList.add("active");
                        textNode.textContent = "REMOVE FROM WISHLIST";

                        // Glow pulse
                        anime({
                            targets: btn,
                            boxShadow: [
                                '0 0 20px rgba(225, 6, 0, 0.3)',
                                '0 0 40px rgba(225, 6, 0, 0.6)',
                                '0 0 20px rgba(225, 6, 0, 0.3)'
                            ],
                            duration: 1000,
                            easing: 'easeOutSine'
                        });

                    } else {
                        // REMOVE FROM WISHLIST ‚Üí SHRINK + UNFILL
                        anime({
                            targets: heartIcon,
                            scale: [1, 1.3, 0.8, 1],
                            duration: 600,
                            easing: 'easeOutQuart'
                        });

                        // Button state change
                        btn.classList.remove("active");
                        textNode.textContent = "ADD TO WISHLIST";

                        // Subtle shake
                        anime({
                            targets: btn,
                            translateX: [-5, 5, -5, 0],
                            duration: 400,
                            easing: 'easeOutSine'
                        });
                    }

                } catch (error) {
                    console.error('Wishlist error:', error);
                } finally {
                    // Re-enable button after 800ms
                    setTimeout(() => {
                        btn.style.pointerEvents = 'auto';
                    }, 800);
                }
            });

            // Floating hearts helper function
            function createFloatingHeart(parent) {
                const heart = document.createElement('span');
                heart.innerHTML = 'üíñ';
                heart.style.cssText = `
                    position: fixed;
                    font-size: 16px;
                    pointer-events: none;
                    z-index: 10000;
                    left: ${parent.getBoundingClientRect().left + 20}px;
                    top: ${parent.getBoundingClientRect().top + 20}px;
                    opacity: 1;
                `;
                document.body.appendChild(heart);

                anime({
                    targets: heart,
                    translateX: anime.random(-50, 50),
                    translateY: anime.random(-100, -150),
                    scale: [1, 0],
                    opacity: [1, 0],
                    rotate: anime.random(-180, 180),
                    duration: anime.random(1000, 1500),
                    easing: 'easeOutSine',
                    complete: () => heart.remove()
                });
            }
        });
    </script>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>



    <div id="ui-alert-overlay">
        <div id="ui-alert-box">
    
            <div id="ui-alert-message"></div>
    
            <div class="ui-alert-actions">
                <!-- OK (errors only) -->
                <button id="ui-alert-ok" onclick="hideUIAlert()">OK</button>
    
                <!-- CLOSE (success only) -->
                <button id="ui-alert-close" onclick="hideUIAlert()">CLOSE</button>
    
                <!-- VIEW CART (success only) -->
                <a id="ui-alert-cart" href="{% url 'cart:cart' %}" class="ui-alert-link">
                    VIEW CART
                </a>
            </div>
    
        </div>
    </div>
    




</body>

</html>