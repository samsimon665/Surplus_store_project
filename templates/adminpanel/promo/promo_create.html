<!DOCTYPE html>
<html class="light" lang="en">


<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Create Promo Code Admin</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#1337ec",
                        "background-light": "#fcfcfd",
                        "background-dark": "#19212e",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.25rem",
                        "lg": "0.5rem",
                        "xl": "0.75rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        body {
            font-family: 'Inter', sans-serif;
        }

        .toggle-checkbox:checked {
            right: 0;
            border-color: #1337ec;
        }

        .toggle-checkbox:checked+.toggle-label {
            background-color: #1337ec;
        }
    </style>
</head>


<body class="bg-background-light dark:bg-background-dark text-[#0d101b] dark:text-gray-100 min-h-screen flex flex-col">


    <!-- Sidebar -->
    {% include "adminpanel/includes/sidebar.html" %}


    <main class="flex-1 ml-64  flex-grow pb-16">

        <div class="max-w-4xl mx-auto px-6 py-8">
            <nav class="flex items-center gap-2 mb-6">
                <a class="text-[#4c599a] dark:text-gray-400 text-sm hover:underline" href="#">Dashboard</a>
                <span class="material-symbols-outlined text-sm text-[#4c599a]">chevron_right</span>
                <a class="text-[#4c599a] dark:text-gray-400 text-sm hover:underline" href="#">Promotions</a>
                <span class="material-symbols-outlined text-sm text-[#4c599a]">chevron_right</span>
                <span class="text-[#0d101b] dark:text-white text-sm font-semibold">Create Promo</span>
            </nav>


            <div class="mb-10">
                <h1 class="text-[#0d101b] dark:text-white text-4xl font-extrabold tracking-tight mb-2">
                    Create Promo Code
                </h1>
                <p class="text-[#4c599a] dark:text-gray-400 text-lg">
                    Configure a new discount code for your store with specific rules and usage limits.
                </p>
            </div>


            {% if form.errors %}
            <div class="mb-4 p-4 rounded-lg bg-red-50 border border-red-300">
            
                <p class="text-sm font-semibold text-red-700 mb-2">
                    Please fix the errors below before submitting.
                </p>
            
                {% for error in form.non_field_errors %}
                <p class="text-sm text-red-600 font-semibold">
                    {{ error }}
                </p>
                {% endfor %}
            
            </div>
            {% endif %}



            <form method="post" novalidate>
                {% csrf_token %}
                <div class="space-y-8">

                    <!-- Promo Identity -->
                    <div
                        class="bg-white dark:bg-gray-900 rounded-xl border border-[#e7e9f3] dark:border-gray-800 shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-[#e7e9f3] dark:border-gray-800 flex items-center gap-3">
                            <span class="material-symbols-outlined text-primary">id_card</span>
                            <h2 class="text-lg font-bold text-[#0d101b] dark:text-white">Promo Identity</h2>
                        </div>


                        <div class="p-6 grid grid-cols-1 md:grid-cols-2 gap-8">

                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-bold text-[#0d101b] dark:text-gray-300 uppercase tracking-wider">
                                    Promo Code
                                </label>
                            
                                <input name="code" value="{{ form.code.value|default_if_none:'' }}"
                                    class="w-full bg-[#f8f9fc] dark:bg-gray-800 border {% if form.code.errors %}border-red-500{% else %}border-[#cfd3e7] dark:border-gray-700{% endif %} rounded-lg h-14 px-4 text-xl font-mono tracking-widest uppercase focus:ring-2 focus:ring-primary/20 focus:border-primary"
                                    placeholder="E.G. SUMMER50" />
                            
                                {% if form.code.errors %}
                                <p class="text-xs text-red-500 mt-1">
                                    {{ form.code.errors.0 }}
                                </p>
                                {% endif %}
                            
                                <p class="text-xs text-[#4c599a] dark:text-gray-500">
                                    Customers will enter this code at checkout.
                                </p>                   
                            </div>


                            <div class="flex flex-col gap-2 justify-center">
                                <label
                                    class="text-sm font-bold text-[#0d101b] dark:text-gray-300 uppercase tracking-wider">
                                    Status
                                </label>

                                <div class="flex items-center gap-3 h-14">
                                    <div
                                        class="relative inline-block w-12 align-middle select-none transition duration-200 ease-in">
                                        <input type="hidden" name="is_active" value="False">
                                        <input type="checkbox" id="toggle" name="is_active" value="True"
                                            class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer right-6 transition-all duration-300"
                                            {% if form.is_active.value %}checked{% endif %} />

                                        <label
                                            class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 dark:bg-gray-700 cursor-pointer transition-colors duration-300"
                                            for="toggle"></label>
                                    </div>
                                    <span class="text-sm font-medium text-[#0d101b] dark:text-gray-300">
                                        Active and ready for use
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Discount Rules -->
                    <div
                        class="bg-white dark:bg-gray-900 rounded-xl border border-[#e7e9f3] dark:border-gray-800 shadow-sm overflow-hidden">

                        <div class="p-6 border-b border-[#e7e9f3] dark:border-gray-800 flex items-center gap-3">
                            <span class="material-symbols-outlined text-primary">sell</span>
                            <h2 class="text-lg font-bold text-[#0d101b] dark:text-white">
                                Discount Rules
                            </h2>
                        </div>

                        <div class="p-6 space-y-8">

                            <!-- Discount Type -->
                            <div class="flex flex-col gap-3">
                                <label
                                    class="text-sm font-bold text-[#0d101b] dark:text-gray-300 uppercase tracking-wider">
                                    Discount Type
                                </label>

                                <!-- Django needs these -->
                                <input type="hidden" name="discount_type" id="discount_type" value="{{ form.discount_type.value|default:'PERCENT' }}">

                                <div class="flex p-1 bg-[#f1f3f9] dark:bg-gray-800 rounded-lg w-full sm:w-fit">
                                    <button type="button" onclick="setDiscountType('PERCENT', this)"
                                        class="discount-btn px-6 py-2 rounded-md bg-white dark:bg-gray-700 text-primary font-bold text-sm shadow-sm transition-all">
                                        Percentage
                                    </button>

                                    <button type="button" onclick="setDiscountType('FLAT', this)"
                                        class="discount-btn px-6 py-2 rounded-md text-[#4c599a] dark:text-gray-400 font-medium text-sm transition-all">
                                        Flat Amount
                                    </button>
                                </div>
                            </div>

                            <!-- Discount Inputs -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                                <!-- Discount Value -->
                                <div class="flex flex-col gap-2">
                                    <label id="discountValueLabel" class="text-sm font-bold text-[#0d101b] dark:text-gray-300 uppercase tracking-wider">
                                        Discount Percentage
                                    </label>
                                
                                    <div class="relative">
                                        <span id="discountSymbol" class="absolute left-4 top-1/2 -translate-y-1/2 text-lg font-bold text-[#4c599a]">
                                            %
                                        </span>
                                
                                        <input type="number" step="0.01" min="0.01" max="50" name="discount_value"
                                            value="{{ form.discount_value.value|default_if_none:'' }}"
                                            class="w-full bg-[#f8f9fc] dark:bg-gray-800 border {% if form.discount_value.errors %}border-red-500{% else %}border-[#cfd3e7] dark:border-gray-700{% endif %} rounded-lg h-14 pl-10 pr-4 text-lg font-semibold focus:ring-2 focus:ring-primary/20 focus:border-primary"
                                            placeholder="0.00" />
                                    </div>
                                
                                    {% if form.discount_value.errors %}
                                    <p class="text-xs text-red-500 mt-1">
                                        {{ form.discount_value.errors.0 }}
                                    </p>
                                    {% endif %}                          
                                </div>




                                <!-- Maximum Discount (ONLY for Percentage) -->
                                <div id="maxDiscountWrapper" class="flex flex-col gap-2">
                                    <label class="text-sm font-bold text-[#0d101b] dark:text-gray-300 uppercase tracking-wider">
                                        Maximum Discount
                                    </label>
                                
                                    <div class="relative">
                                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-lg font-bold text-[#4c599a]">
                                            ₹
                                        </span>
                                
                                        <input type="number" step="0.01" min="0.01" name="maximum_discount_amount"
                                            value="{{ form.maximum_discount_amount.value|default_if_none:'' }}"
                                            class="w-full bg-[#f8f9fc] dark:bg-gray-800 border {% if form.maximum_discount_amount.errors %}border-red-500{% else %}border-[#cfd3e7] dark:border-gray-700{% endif %} rounded-lg h-14 pl-10 pr-4 text-lg font-semibold focus:ring-2 focus:ring-primary/20 focus:border-primary"
                                            placeholder="499" />
                                    </div>
                                
                                    {% if form.maximum_discount_amount.errors %}
                                    <p class="text-xs text-red-500 mt-1">
                                        {{ form.maximum_discount_amount.errors.0 }}
                                    </p>
                                    {% endif %}
                                
                                    <p class="text-xs text-[#4c599a] dark:text-gray-500">
                                        Required for percentage discounts. Caps discount amount.
                                    </p>
                                </div>



                            </div>
                        </div>
                    </div>

                    <!-- Cart Conditions + Usage Limits -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div
                            class="bg-white dark:bg-gray-900 rounded-xl border border-[#e7e9f3] dark:border-gray-800 shadow-sm overflow-hidden h-full">
                            <div class="p-6 border-b border-[#e7e9f3] dark:border-gray-800 flex items-center gap-3">
                                <span class="material-symbols-outlined text-primary">shopping_cart</span>
                                <h2 class="text-lg font-bold text-[#0d101b] dark:text-white">Cart Conditions</h2>
                            </div>
                            <div class="p-6 space-y-4">

                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-bold text-[#0d101b] dark:text-gray-300 uppercase tracking-wider">
                                        Minimum Cart Value
                                    </label>
                                
                                    <div class="relative">
                                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-lg font-bold text-[#4c599a]">
                                            ₹
                                        </span>
                                
                                        <input type="number" step="0.01" min="0" name="minimum_cart_value"
                                            value="{{ form.minimum_cart_value.value|default_if_none:'' }}"
                                            class="w-full bg-[#f8f9fc] dark:bg-gray-800 border {% if form.minimum_cart_value.errors %}border-red-500{% else %}border-[#cfd3e7] dark:border-gray-700{% endif %} rounded-lg h-14 pl-10 pr-4 text-lg font-semibold focus:ring-2 focus:ring-primary/20 focus:border-primary"
                                            placeholder="0.00" />
                                    </div>
                                
                                    {% if form.minimum_cart_value.errors %}
                                    <p class="text-xs text-red-500 mt-1">
                                        {{ form.minimum_cart_value.errors.0 }}
                                    </p>
                                    {% endif %}
                                
                                    <p class="text-xs text-[#4c599a] dark:text-gray-500">
                                        Promotion applies only above this cart value.
                                    </p>
                                </div>


                            </div>
                        </div>

                        <div
                            class="bg-white dark:bg-gray-900 rounded-xl border border-[#e7e9f3] dark:border-gray-800 shadow-sm overflow-hidden h-full">
                            <div class="p-6 border-b border-[#e7e9f3] dark:border-gray-800 flex items-center gap-3">
                                <span class="material-symbols-outlined text-primary">groups</span>
                                <h2 class="text-lg font-bold text-[#0d101b] dark:text-white">Usage Limits</h2>
                            </div>
                            <div class="p-6 space-y-4">

                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-bold text-[#0d101b] dark:text-gray-300 uppercase tracking-wider">
                                        Total Usage Limit
                                    </label>
                                
                                    <input type="number" min="1" max="100" step="1" name="usage_limit_total"
                                        value="{{ form.usage_limit_total.value|default_if_none:'' }}"
                                        class="w-full bg-[#f8f9fc] dark:bg-gray-800 border {% if form.usage_limit_total.errors %}border-red-500{% else %}border-[#cfd3e7] dark:border-gray-700{% endif %} rounded-lg h-14 px-4 text-lg font-semibold focus:ring-2 focus:ring-primary/20 focus:border-primary"
                                        placeholder="0" />
                                
                                    {% if form.usage_limit_total.errors %}
                                    <p class="text-xs text-red-500 mt-1">
                                        {{ form.usage_limit_total.errors.0 }}
                                    </p>
                                    {% endif %}
                                
                                    <p class="text-xs text-[#4c599a] dark:text-gray-500">
                                    Example: 50 means 50 total users can use this promo.
                                    </p>
                                </div>


                            </div>
                        </div>
                    </div>



                    <!-- Validity Period -->
                    <div
                        class="bg-white dark:bg-gray-900 rounded-xl border border-[#e7e9f3] dark:border-gray-800 shadow-sm overflow-hidden">
                        <div class="p-6 border-b border-[#e7e9f3] dark:border-gray-800 flex items-center gap-3">
                            <span class="material-symbols-outlined text-primary">calendar_today</span>
                            <h2 class="text-lg font-bold text-[#0d101b] dark:text-white">Validity Period</h2>
                        </div>

                        <div class="p-6 space-y-8">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">

                                <!-- VALID FROM -->

                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-bold text-[#0d101b] dark:text-gray-300 uppercase tracking-wider">
                                        Valid From
                                    </label>
                                
                                    <div class="relative">
                                        <span class="absolute left-4 top-1/2 -translate-y-1/2 material-symbols-outlined text-[#4c599a]">
                                            event
                                        </span>
                                
                                        <input type="datetime-local" name="valid_from" value="{{ form.valid_from.value|date:'Y-m-d\\TH:i' }}"
                                            class="w-full bg-[#f8f9fc] dark:bg-gray-800 border {% if form.valid_from.errors %}border-red-500{% else %}border-[#cfd3e7] dark:border-gray-700{% endif %} rounded-lg h-14 pl-12 pr-4 text-sm font-semibold focus:ring-2 focus:ring-primary/20 focus:border-primary" />
                                    </div>
                                
                                    {% if form.valid_from.errors %}
                                    <p class="text-xs text-red-500 mt-1">
                                        {{ form.valid_from.errors.0 }}
                                    </p>
                                    {% endif %}                          
                                </div>


                                <!-- VALID TO -->


                                <div class="flex flex-col gap-2">
                                    <label class="text-sm font-bold text-[#0d101b] dark:text-gray-300 uppercase tracking-wider">
                                        Valid To
                                    </label>
                                
                                    <div class="relative">
                                        <span class="absolute left-4 top-1/2 -translate-y-1/2 material-symbols-outlined text-[#4c599a]">
                                            event_busy
                                        </span>
                                
                                        <input type="datetime-local" name="valid_to" value="{{ form.valid_to.value|date:'Y-m-d\\TH:i' }}"
                                            class="w-full bg-[#f8f9fc] dark:bg-gray-800 border {% if form.valid_to.errors %}border-red-500{% else %}border-[#cfd3e7] dark:border-gray-700{% endif %} rounded-lg h-14 pl-12 pr-4 text-sm font-semibold focus:ring-2 focus:ring-primary/20 focus:border-primary" />
                                    </div>
                                
                                    {% if form.valid_to.errors %}
                                    <p class="text-xs text-red-500 mt-1">
                                        {{ form.valid_to.errors.0 }}
                                    </p>
                                    {% endif %}                          
                                </div>



                            </div>

                            <div class="flex items-center gap-2 p-4 bg-primary/5 dark:bg-primary/10 rounded-lg">
                                <span class="material-symbols-outlined text-primary text-sm">info</span>
                                <p class="text-xs font-medium text-primary uppercase tracking-tight">
                                    Timezone hint: All times are calculated based on IST (UTC+5:30).
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Actions (replaces fixed footer) -->
                    <div class="flex items-center justify-between pt-4">
                        <a href="{% url 'adminpanel:promo_list' %}"
                            class="px-8 py-3.5 text-sm font-bold text-[#4c599a] dark:text-gray-400 border border-[#cfd3e7] dark:border-gray-700 rounded-xl hover:bg-gray-50 dark:hover:bg-gray-800 hover:text-red-500 transition-all active:scale-95 inline-flex items-center justify-center">
                            Cancel
                        </a>

                        <button type="submit"
                            class="bg-primary text-white px-10 py-3.5 rounded-xl text-sm font-bold tracking-wide shadow-xl shadow-primary/25 hover:shadow-primary/40 hover:bg-primary/90 active:scale-95 transition-all">
                            Create Promo Code
                        </button>
                    </div>


                </div>
            </form>



        </div>
    </main>




    <script>
        function setDiscountType(type, btn) {
            document.getElementById("discount_type").value = type;

            const symbol = document.getElementById("discountSymbol");
            const label = document.getElementById("discountValueLabel");
            const maxWrapper = document.getElementById("maxDiscountWrapper");
            const maxInput = document.querySelector(
                'input[name="maximum_discount_amount"]'
            );

            document.querySelectorAll(".discount-btn").forEach(b => {
                b.classList.remove(
                    "bg-white", "dark:bg-gray-700", "text-primary", "font-bold", "shadow-sm"
                );
                b.classList.add("text-[#4c599a]", "dark:text-gray-400");
            });

            if (type === "PERCENT") {
                symbol.textContent = "%";
                label.textContent = "Discount Percentage";
                maxWrapper.style.display = "flex";
                maxInput.required = true;
            } else {
                symbol.textContent = "₹";
                label.textContent = "Discount Amount";
                maxWrapper.style.display = "none";
                maxInput.required = false;
                maxInput.value = "";
            }

            btn.classList.add(
                "bg-white", "dark:bg-gray-700", "text-primary", "font-bold", "shadow-sm"
            );
        }
    </script>




</body>


</html>