<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Email Verification | Surplus Store</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-black flex items-center justify-center px-4">

    <div class="w-full max-w-md border border-white/20 rounded-2xl p-10 bg-black text-center">

        <h1 class="text-2xl text-white mb-4">SURPLUS STORE</h1>
        <p class="text-white/60 mb-6">Verify your email to activate your account</p>

        {% if messages %}
        {% for message in messages %}
        <div class="border border-white text-white text-sm py-2 px-3 mb-4 rounded-lg">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}

        <!-- ⏳ Countdown -->
        <p id="timer" class="text-sm text-white/50 mb-4 hidden"></p>

        <!-- ✅ SEND / RESEND FORM -->
        <form method="post" action="{% url 'accounts:send_verification' %}">
            {% csrf_token %}
            <button id="sendBtn" class="w-full py-3 mb-4 border border-white rounded-full text-white
      hover:bg-white hover:text-black transition">

                Send Verification Email
            </button>
        </form>

        <a href="{% url 'accounts:login' %}" class="text-xs text-white/70 hover:text-white">
            Back to Login
        </a>

    </div>

    <script>
        let cooldown = localStorage.getItem("emailCooldown");
        const btn = document.getElementById("sendBtn");
        const timerText = document.getElementById("timer");

        function startCooldown(seconds) {
            btn.disabled = true;
            btn.innerText = "Resend in 5:00";
            timerText.classList.remove("hidden");

            let remaining = seconds;

            const interval = setInterval(() => {
                let min = Math.floor(remaining / 60);
                let sec = remaining % 60;

                btn.innerText = `Resend in ${min}:${sec < 10 ? "0" : ""}${sec}`;
                timerText.innerText = `You can resend after ${min}:${sec < 10 ? "0" : ""}${sec}`;

                remaining--;

                if (remaining < 0) {
                    clearInterval(interval);
                    btn.disabled = false;
                    btn.innerText = "Resend Verification Email";
                    timerText.classList.add("hidden");
                    localStorage.removeItem("emailCooldown");
                }
            }, 1000);
        }

        if (cooldown) {
            const diff = Math.floor((cooldown - Date.now()) / 1000);
            if (diff > 0) startCooldown(diff);
        }

        btn?.addEventListener("click", () => {
            const endTime = Date.now() + 5 * 60 * 1000;
            localStorage.setItem("emailCooldown", endTime);
        });
    </script>

</body>

</html>